---
title: "STATS 451 Homework 3"
author: "Yuzhou Peng"
date: "2024-02-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Problem 1
$$
\theta \text{ is the proportion of girls in total births.}\\
\text{Let }y_i = 
\begin{cases} 
1, & \mbox{i-th birth is a girl}\\ 
0, & \mbox{otherwise} 
\end{cases}\\
y_i \overset{\mathrm{iid}}{\sim} Bernoul(\theta)\\
\text{The likelihood is given by: } \mathbb{P}(y_1, y_2...y_{1000}|\theta) = \prod_{i=1}^{1000} \mathbb{P}(y_i|\theta) = \theta^{450}(1-\theta)^{550}\\
\text{The posterior is given by: } \mathbb{P}(\theta|y_1, y_1...y_{1000})= \frac{\mathbb{P}(y_1, y_2...y_{1000}|\theta)\mathbb{P}(\theta)}{\mathbb{P}(y)}= b*\theta^{450}(1-\theta)^{550}\text{ where b is the normalizing constant.}\\
\theta|y_1,y_2...y_{1000} \sim Beta(451,551)
$$

# Problem 2
```{r}
# According to we have derived in problem 1, the posterior follows distribution of Beta(451, 551)
s1 <- 451
s2 <- 551

expect_pos <- s1/(s1 + s2)
variance_pos <- s1*s2/((s1 + s2)^2 * (s1 + s2 + 1))

expect_pos
variance_pos

p_ci <- c(0.025, 0.975)
q_ci_pos <- qbeta(p_ci, shape1 = s1, shape2 = s2)

q_ci_pos
```
The expectation and variance of posterior distribution are 0.450 and 0.000247  
A 95% confidence interval is [0.419, 0.481]  


# Problem 3
```{r}
set.seed(451)

sample_pos <- rbeta(2000, shape1 = s1, shape2 = s2)
sample_step <- seq(0.1,1, by = 0.001)

hist(sample_pos,
     freq = F,
     xlim = c(0,1),
     main = "Histogram of samples from posterior distribution")
lines(sample_step, dnorm(sample_step, mean = expect_pos, sd = (variance_pos)^(1/2)), col = "red")
```

The histogram looks very similar to Gaussian distribution  

# Problem 4
```{r}
lambda <- log(sample_pos/(1-sample_pos))
lambda_step <- seq(-0.5, 0, by = 0.001)

mean_lambda <- mean(lambda)
variance_lambda <- var(lambda)
ci_lambda <- quantile(lambda, probs = c(0.02, 0.98))

hist(lambda,
     freq = F,
     breaks = 20)
lines(lambda_step, dnorm(lambda_step, mean = mean_lambda, sd = (variance_lambda^(1/2))), col = "blue")

mean_lambda
variance_lambda
ci_lambda
```

The histogram is similar to Gaussian distribution  
Expected value is -0.200  
Variance is 0.00407  
A 96% confidence interval is [-0.326, -0.0586]  


# Problem 5
```{r}
pbeta(0.485, s1, s2)
```

Based on the data, we have 98.66% confidence to claim that proportion of girl births under the special condition is less than 0.485

# Problem 6

## 6.1
```{r}
s1_prime <- 5
s2_prime <- 7

expect_pos_prime <- s1_prime/(s1_prime + s2_prime)
variance_pos_prime <- s1_prime*s2_prime/((s1_prime + s2_prime)^2 * (s1_prime + s2_prime + 1))

expect_pos_prime
variance_pos_prime
qbeta(p_ci, shape1 = s1_prime, shape2 = s2_prime)
```
The expectation and variance of posterior distribution are 0.417 and 0.0187  
A 95% confidence interval is [0.167, 0.692]  

In comparison with posterior of larger sample, variance is much larger and confidence interval is much wider.  
The expected value is more affected by the prior mean.  

## 6.2
```{r}
set.seed(451)

sample_pos_prime <- rbeta(2000, shape1 = s1_prime, shape2 = s2_prime)
sample_step <- seq(0.1,1, by = 0.001)

hist(sample_pos_prime,
     freq = F,
     xlim = c(0,1),
     main = "Histogram of samples from posterior distribution")
lines(sample_step, dnorm(sample_step, mean = expect_pos_prime, sd = (variance_pos_prime)^(1/2)), col = "red")
```

## 6.3
```{r}
lambda_prime <- log(sample_pos_prime/(1-sample_pos_prime))
lambda_step_prime <- seq(-3, 3, by = 0.001)

mean_lambda_prime <- mean(lambda_prime)
variance_lambda_prime <- var(lambda_prime)
ci_lambda_prime <- quantile(lambda_prime, probs = c(0.02, 0.98))

hist(lambda_prime,
     freq = F,
     breaks = 20)
lines(lambda_step_prime, dnorm(lambda_step_prime, mean = mean_lambda_prime, sd = (variance_lambda_prime^(1/2))), col = "blue")

mean_lambda_prime
variance_lambda_prime
ci_lambda_prime
```

The histogram is similar to Gaussian distribution  
Expected value is -0.355  
Variance is 0.369  
A 96% confidence interval is [-1.59, 0.974]  

In comparison with posterior of larger sample, variance is much larger and confidence interval is much wider.  

## 6.4
```{r}
pbeta(0.485, s1_prime, s2_prime)
```

Compared with the posterior of larger sample, we have lower confidence (69.08% compared with 98.66%) to claim the proportion of girl birth  
is lower than 0.485 even though the posterior mean is less than large sample posterior mean.